# 时间记录和标签关联逻辑

## 概述
FocusTracker 采用**手动时间记录 + 智能分类**的方式来追踪用户的专注时间，并通过分类系统将时间记录与标签关联。

## 技术限制说明

### iOS系统限制
由于iOS的沙盒机制和隐私保护政策，第三方应用无法：
- 直接监控其他应用的使用情况
- 获取系统级的应用切换事件
- 访问Screen Time数据（需要特殊权限）

### 产品设计调整
基于技术限制，我们采用以下设计：

## 时间记录流程

### 1. 手动专注时间记录
- 用户主动开始专注会话
- 设置专注类别（工作、学习、娱乐等）
- 可选择具体的活动名称
- 系统记录开始和结束时间

### 2. 活动分类系统
```swift
// 预设活动模板
let activityTemplates = [
    // 工作类活动
    "编程开发": "工作",
    "会议讨论": "工作", 
    "文档编写": "工作",
    "邮件处理": "工作",
    "项目规划": "工作",
    
    // 学习类活动
    "阅读书籍": "学习",
    "在线课程": "学习",
    "技能练习": "学习",
    "语言学习": "学习",
    
    // 娱乐类活动
    "观看视频": "娱乐",
    "听音乐": "娱乐",
    "游戏娱乐": "娱乐",
    "社交媒体": "娱乐",
    
    // 健康类活动
    "运动锻炼": "健康",
    "冥想放松": "健康",
    "户外活动": "健康"
]
```

### 3. 智能分类逻辑
1. **活动名称匹配**：根据用户输入的活动名称进行分类建议
2. **历史记录学习**：基于用户的历史分类习惯提供建议
3. **快速选择**：提供常用活动的快速选择选项
4. **自定义扩展**：用户可以创建自定义活动模板

## 标签管理系统

### 1. 预设标签
- 工作 (蓝色)
- 学习 (绿色) 
- 娱乐 (橙色)
- 社交 (粉色)
- 健康 (红色)
- 购物 (紫色)
- 出行 (青色)

### 2. 自定义标签
- 用户可以创建自定义标签
- 每个标签可以设置颜色
- 可以设置标签的优先级

### 3. 标签关联规则
```swift
// 专注会话的数据结构
struct FocusSession {
    let id: UUID
    let startTime: Date
    let endTime: Date
    let activityName: String // 活动名称（如"编程开发"）
    let category: String // 分类标签（如"工作"）
    let duration: TimeInterval
    let isCompleted: Bool // 是否完成目标时长
    let notes: String? // 可选的备注
}
```

## 数据流程图

```
用户开始专注会话
    ↓
选择/输入活动名称
    ↓
系统建议分类标签
    ↓
用户确认或调整分类
    ↓
开始计时
    ↓
用户结束会话
    ↓
存储到 Core Data
    ↓
在UI中展示分类统计
```

## 时间块分析

### 整块时间识别
- **连续30分钟以上**：同一应用或同一分类的连续使用
- **中等时间块(15-30分钟)**：中等长度的连续使用
- **碎片时间(15分钟以下)**：短时间的应用切换

### 分析算法
```swift
func analyzeTimeBlocks(sessions: [AppUsageSession]) -> TimeBlockAnalysis {
    var blockTime: TimeInterval = 0
    var mediumTime: TimeInterval = 0
    var fragmentTime: TimeInterval = 0
    
    for session in sessions {
        let duration = session.duration
        
        if duration >= 30 * 60 { // 30分钟以上
            blockTime += duration
        } else if duration >= 15 * 60 { // 15-30分钟
            mediumTime += duration
        } else { // 15分钟以下
            fragmentTime += duration
        }
    }
    
    return TimeBlockAnalysis(
        blockTime: blockTime,
        mediumTime: mediumTime,
        fragmentTime: fragmentTime
    )
}
```

## 用户交互

### 1. 自动分类
- 大部分时间记录自动分类
- 基于应用名称和使用模式

### 2. 手动调整
- 用户可以在"管理时间分类"中调整规则
- 可以为特定应用设置自定义分类
- 支持批量修改历史记录

### 3. 学习优化
- 系统会学习用户的分类偏好
- 逐步提高自动分类的准确性

## 隐私保护

### 1. 本地存储
- 所有时间记录数据存储在本地
- 不会上传到服务器

### 2. 应用权限
- 只记录应用使用时长
- 不记录具体的应用内容

### 3. 用户控制
- 用户可以随时删除记录
- 可以设置不记录特定应用
## 产品设计方案对
比

### 方案1：手动专注时间记录（推荐实现）

**优势**：
- ✅ 技术可行，无需特殊权限
- ✅ 用户主动参与，提高专注意识
- ✅ 数据准确，用户明确知道在做什么
- ✅ 隐私友好，不涉及系统级监控
- ✅ 符合番茄工作法等成熟的时间管理理念

**实现方式**：
1. 用户开始专注前选择活动类型
2. 系统提供活动模板和分类建议
3. 计时器记录专注时长
4. 结束后自动保存到对应分类

**用户体验**：
```
用户想要专注工作 → 点击"开始专注" → 选择"编程开发"(工作类) → 开始计时 → 专注25分钟 → 结束并保存
```

### 方案2：屏幕时间集成（技术限制）

**技术挑战**：
- ❌ 需要Screen Time API权限（主要用于家长控制）
- ❌ 用户需要在系统设置中授权
- ❌ API功能有限，数据获取复杂
- ❌ 苹果审核可能拒绝

### 方案3：混合方案（未来扩展）

**可能的扩展**：
- 集成Shortcuts自动化
- 通过Focus模式状态推断活动类型
- 结合日历事件自动分类
- 使用Siri Shortcuts快速开始专注

## 用户界面设计

### 主要交互流程

1. **开始专注**
   - 快速开始按钮
   - 活动选择界面
   - 时长设置
   - 分类确认

2. **专注进行中**
   - 计时器显示
   - 暂停/继续功能
   - 提前结束选项
   - 背景运行支持

3. **专注结束**
   - 完成确认
   - 效果评价（可选）
   - 自动保存记录
   - 统计更新

### 数据展示优化

**时间明细页面调整**：
- 显示"专注会话"而不是"应用名称"
- 展示活动名称（如"编程开发"）
- 保留分类颜色编码
- 添加完成度指标

**统计分析增强**：
- 专注效率分析
- 目标达成率
- 最佳专注时段
- 分类时间分布

## 实施建议

### 第一阶段：基础功能
1. 实现手动专注时间记录
2. 基本的分类系统
3. 简单的统计展示

### 第二阶段：智能化
1. 活动模板系统
2. 智能分类建议
3. 历史数据学习

### 第三阶段：高级功能
1. 专注质量评估
2. 个性化建议
3. 数据导出功能

## 用户教育

### 引导用户理解
- 解释为什么需要手动记录
- 强调隐私保护的好处
- 展示专注时间管理的价值

### 降低使用门槛
- 提供丰富的活动模板
- 智能的分类建议
- 快速开始选项
- 历史记录复用

这种设计既解决了技术限制问题，又能提供有价值的时间管理功能，是一个现实可行的产品方案。