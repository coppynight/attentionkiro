# 实施计划

## MVP版本（第一阶段 - 基于现有项目的功能扩展）

- [x] 1. 扩展现有数据模型以支持时间分析功能
  - 在现有FocusDataModel.xcdatamodeld中添加新实体（AppUsageSession, SceneTag）
  - 扩展现有UserSettings实体以支持新的设置选项
  - 更新PersistenceController以处理新的数据模型
  - 保持现有FocusSession实体的向后兼容性
  - _需求: 1.12, 2.1_

- [x] 2. 扩展现有UsageMonitor以支持应用使用监控
  - [x] 2.1 在现有Info.plist基础上添加DeviceActivity权限
    - 扩展现有权限声明以支持DeviceActivity Framework
    - 在现有权限检查流程中添加新的权限状态检查
    - 扩展现有设置界面以引导用户授权新权限
    - _需求: 1.1, 1.8, 10.1_

  - [x] 2.2 扩展现有UsageMonitor类的功能
    - 在现有UsageMonitor.swift中添加DeviceActivity集成
    - 扩展现有的后台监控机制以支持应用使用数据收集
    - 保持现有专注时间监控功能的完整性
    - _需求: 1.1, 1.2, 1.3, 1.4_

  - [x] 2.3 扩展现有数据存储机制
    - 在现有PersistenceController基础上添加新数据类型的存储
    - 扩展现有的数据完整性检查以支持应用使用数据
    - 保持与现有FocusSession数据的兼容性
    - _需求: 1.11, 1.12_

- [x] 3. 创建新的TagManager服务（基于现有服务架构）
  - [x] 3.1 在Services目录中创建TagManager.swift
    - 参考现有FocusManager.swift的架构模式创建TagManager
    - 实现7个默认场景标签的创建和管理
    - 建立应用类别到标签的基础映射关系
    - 集成到现有的依赖注入系统中
    - _需求: 9.1, 9.3_

  - [x] 3.2 实现标签推荐和应用功能
    - 在TagManager中添加基于应用类别的标签推荐逻辑
    - 实现标签的应用和修改功能
    - 创建标签选择UI组件并集成到现有界面中
    - _需求: 9.2, 9.4_

- [x] 4. 创建TimeAnalysisManager扩展现有统计功能
  - [x] 4.1 在Services目录中创建TimeAnalysisManager.swift
    - 参考现有FocusManager的统计功能架构
    - 扩展现有的时间统计逻辑以支持应用使用分析
    - 实现今日使用时间和应用分布计算
    - 建立7天使用趋势数据生成，与现有专注趋势并存
    - _需求: 2.1, 2.2, 2.3_

  - [x] 4.2 集成场景标签统计功能
    - 在TimeAnalysisManager中添加标签相关的统计计算
    - 按场景标签分组显示时间分布
    - 创建标签使用占比计算功能
    - 与现有专注时间统计形成互补
    - _需求: 9.5, 9.8_

- [x] 5. 扩展现有用户界面以支持新功能
  - [x] 5.1 扩展现有HomeView.swift
    - 在现有专注时间显示基础上添加TimeUsageRingView组件
    - 添加AppBreakdownView应用使用分布显示
    - 集成SceneTagSummaryView标签汇总到现有布局
    - 保持现有专注时间显示功能
    - _需求: 2.1, 2.3_

  - [x] 5.2 扩展现有StatisticsView.swift
    - 在现有统计图表基础上添加WeeklyTrendChart
    - 添加AppUsageRankingView应用使用排行
    - 集成SceneTagAnalysisView场景分析功能
    - 保持现有专注统计的完整性
    - _需求: 2.2, 2.7_

  - [x] 5.3 在Views目录中创建新的TagsView.swift并更新ContentView
    - 参考现有Views的架构模式创建标签管理界面
    - 实现CustomTagsView自定义标签创建功能
    - 建立TagEditingView标签编辑界面
    - 在现有ContentView.swift的TabView中添加新的标签管理标签页
    - 保持现有标签页的功能和布局
    - _需求: 9.3, 9.4_

- [x] 6. 扩展现有SettingsView.swift以支持新设置
  - [x] 6.1 在现有设置界面中添加时间目标设置
    - 扩展现有的专注目标设置以支持应用使用时间目标
    - 在现有目标进度显示中添加新的目标类型
    - 保持现有专注目标设置的功能
    - _需求: 7.1, 7.2, 7.3_

  - [x] 6.2 扩展现有时间范围设置功能
    - 在现有的活跃时间设置基础上添加新的时间范围选项
    - 扩展现有的睡眠时间和午休时间设置
    - 保持与现有专注时间计算的兼容性
    - _需求: 8.1, 8.2, 8.3, 8.4_

- [x] 7. 集成测试和优化扩展功能
  - [x] 7.1 扩展现有测试以覆盖新功能
    - 在现有FocusTrackerTests中添加新功能的单元测试
    - 测试TagManager和TimeAnalysisManager的功能
    - 验证新数据模型与现有数据的兼容性
    - 确保现有专注追踪功能不受影响
    - _需求: 所有MVP功能_

  - [x] 7.2 优化整体用户体验
    - 优化新旧功能的界面整合
    - 实现新功能的错误处理，与现有错误处理保持一致
    - 扩展现有的用户引导流程以介绍新功能
    - _需求: 6.1, 6.2, 6.3_

  - [x] 7.3 准备扩展版本发布
    - 完成新功能与现有功能的集成测试
    - 更新应用描述以反映新的时间分析功能
    - 确保向后兼容性和数据迁移的正确性
    - _需求: 所有MVP功能完整性_

## 后续版本功能（第二阶段 - 基于扩展版本的高级功能）

- [ ] 8. 在现有架构基础上实现AI分析引擎
  - [ ] 8.1 创建AIAnalysisEngine服务
    - 在Services目录中创建AIAnalysisEngine.swift
    - 集成Core ML进行行为模式识别
    - 基于现有数据模型实现使用习惯分析
    - 与现有FocusManager协同工作
    - _需求: 3.1, 3.2, 3.5_

  - [ ] 8.2 扩展现有通知系统实现智能建议
    - 扩展现有NotificationManager以支持AI驱动的通知
    - 基于AI分析结果生成个性化建议
    - 与现有通知系统保持一致的用户体验
    - _需求: 3.3, 3.7, 3.8_

- [ ] 9. 扩展现有通知系统为智能通知
  - [ ] 9.1 增强现有NotificationManager功能
    - 在现有NotificationManager基础上添加智能调度
    - 扩展现有通知类型以支持多样化的智能提醒
    - 保持与现有通知设置的兼容性
    - _需求: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8_

- [ ] 10. 基于现有架构开发小组件功能
  - [ ] 10.1 创建小组件扩展
    - 基于现有数据模型创建小组件数据提供者
    - 利用现有的统计功能为小组件提供数据
    - 与主应用的现有功能保持数据一致性
    - _需求: 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 11. 扩展现有分析功能为高级分析
  - [ ] 11.1 增强现有StatisticsView
    - 在现有统计界面基础上添加高级可视化
    - 实现使用热力图和复杂行为模式图表
    - 与现有专注统计形成完整的分析体系
    - _需求: 2.4, 2.5, 2.6, 2.8_

- [ ] 12. 整体优化和完善
  - [ ] 12.1 全面性能优化
    - 优化新旧功能的整体性能
    - 改进电池使用效率，确保后台功能高效运行
    - 增强数据处理能力，支持更大数据量
    - _需求: 性能相关需求_

  - [ ] 12.2 完整版本测试和发布
    - 完成新旧功能的全面集成测试
    - 进行完整的性能和安全审计
    - 准备功能完整的正式版本发布
    - _需求: 所有功能完整性_