# 需求文档

## 介绍

智能时间分析应用是一个iOS应用，基于现有的FocusTracker专注追踪项目进行扩展开发。通过监控和统计用户的手机使用行为习惯，帮助用户了解自己每天的时间分布。

**现有项目基础**：
- 已实现专注时间追踪和基础统计功能
- 具备Core Data数据存储和后台监控能力
- 包含基础的通知系统和用户界面
- 现有架构：FocusManager、UsageMonitor、NotificationManager等核心服务

**MVP版本扩展目标**：
- 扩展为全面的应用使用时间监控
- 添加场景标签分类和手动标签管理
- 增强统计分析和可视化功能
- 改进用户界面以支持新的时间分析功能

**后续版本功能**：
- 高级AI分析和个性化洞察
- 智能通知和小组件
- 复杂的行为模式识别
- 预测性分析和优化建议

## 需求

### 需求 1

**用户故事：** 作为一个想要了解自己时间使用习惯的用户，我想要应用能够全面监控我的手机使用行为，这样我就能获得详细的时间分布数据和使用模式分析。

#### 验收标准

1. 当用户打开手机屏幕时，系统应当记录屏幕激活时间和持续时长
2. 当用户使用不同应用时，系统应当记录每个应用的使用时长和切换频率
3. 当用户在应用间切换时，系统应当记录切换模式和应用使用序列
4. 当用户锁定手机屏幕时，系统应当记录使用会话结束时间和总时长
5. 当检测到连续使用模式时，系统应当识别用户的活跃使用时段
6. 当检测到手机空闲时段时，系统应当记录空闲时长和发生时间
7. 当收集到足够数据时，系统应当分析用户的日常使用节奏和高峰时段
8. 当应用进入后台时，系统应当启动后台任务以继续数据收集
9. 当应用在后台运行时，系统应当使用BGTaskScheduler调度数据处理任务
10. 当后台任务运行时，系统应当监控设备使用状态并记录相关数据
11. 当应用重新进入前台时，系统应当同步后台收集的使用数据
12. 当数据收集完成时，系统应当将原始数据存储到本地数据库中

### 需求 2

**用户故事：** 作为用户，我想要看到详细的时间使用统计和分析报告，这样我就能全面了解自己的数字生活习惯和时间分配模式。

#### 验收标准

1. 当用户打开应用时，系统应当显示今日手机总使用时间和应用分布
2. 当用户查看统计页面时，系统应当显示过去7天的使用时间趋势和变化
3. 当用户查看应用分析时，系统应当显示各应用的使用时长排名和占比
4. 当用户查看时间分布时，系统应当显示24小时内的使用密度热力图
5. 当用户查看使用模式时，系统应当显示工作日vs周末的使用差异
6. 当用户查看专注分析时，系统应当显示连续使用时段和中断频率
7. 当用户查看历史数据时，系统应当提供月度和年度的使用趋势对比
8. 如果检测到使用习惯变化，系统应当高亮显示并提供分析说明

### 需求 3

**用户故事：** 作为用户，我想要获得AI驱动的个性化分析和建议，这样我就能基于数据洞察来优化我的时间管理和生活习惯。

#### 验收标准

1. 当收集到足够使用数据时，AI系统应当分析用户的行为模式和习惯特征
2. 当AI分析完成时，系统应当生成个性化的时间使用洞察报告
3. 当检测到不良使用模式时，AI应当提供具体的改善建议和行动方案
4. 当用户查看AI分析时，系统应当显示使用效率评分和改进空间
5. 当AI识别到用户的高效时段时，系统应当建议如何更好利用这些时间
6. 当检测到使用习惯变化时，AI应当分析变化原因并提供适应性建议
7. 当用户设定目标时，AI应当基于历史数据提供可达成的个性化目标建议
8. 当生成周报或月报时，AI应当提供趋势分析和未来预测

### 需求 4

**用户故事：** 作为用户，我想要收到智能化的使用总结和提醒通知，这样我就能及时了解自己的时间使用情况并获得改善建议。

#### 验收标准

1. 当每天晚上设定时间时，系统应当发送包含当日使用总结的智能通知
2. 当用户点击通知时，系统应当打开应用并显示详细的AI分析报告
3. 当检测到过度使用某类应用时，系统应当发送温和的提醒和建议
4. 当用户的使用模式出现积极变化时，系统应当发送鼓励性通知
5. 当AI检测到用户可能需要休息时，系统应当发送健康提醒通知
6. 当用户连续几天保持良好使用习惯时，系统应当发送成就通知
7. 当检测到异常使用模式时，系统应当发送关怀性提醒
8. 如果用户禁用通知，系统应当尊重用户设置并停止发送通知

### 需求 5

**用户故事：** 作为用户，我想要在iPhone主屏幕上有一个小组件显示我的使用数据，这样我就能快速查看时间分布而不需要打开应用。

#### 验收标准

1. 当用户添加小组件到主屏幕时，系统应当显示今日使用时间和主要应用分布
2. 当使用数据更新时，小组件应当实时刷新显示最新统计
3. 当用户点击小组件时，系统应当打开主应用并显示详细分析
4. 当用户长按小组件时，系统应当提供快速操作选项（如查看AI洞察）
5. 如果没有使用数据，小组件应当显示鼓励用户开始监控的信息

### 需求 6

**用户故事：** 作为用户，我想要应用界面美观且易于理解，这样我就能愉快地使用应用并轻松理解我的专注数据。

#### 验收标准

1. 当用户打开应用时，界面应当遵循iOS设计规范并具有现代感
2. 当显示专注数据时，系统应当使用清晰的图表和可视化元素
3. 当用户浏览不同页面时，动画过渡应当流畅自然
4. 当显示专注时间时，系统应当使用易于理解的颜色编码（绿色表示良好专注）
5. 如果用户使用深色模式，应用应当完美适配深色主题

### 需求 7

**用户故事：** 作为用户，我想要设置个人专注目标，这样我就能根据自己的需求定制专注追踪体验。

#### 验收标准

1. 当用户首次使用应用时，系统应当引导用户设置每日专注时间目标
2. 当用户修改专注目标时，系统应当保存新设置并更新相关显示
3. 当用户达到每日目标时，系统应当显示庆祝动画和鼓励信息
4. 当用户连续一周达到目标时，系统应当建议适当提高目标挑战自己
5. 如果用户多天未达到目标，系统应当建议调整为更现实的目标

### 需求 8

**用户故事：** 作为用户，我想要设置我的活跃时间和休息时间，这样应用就能准确识别真正的专注时段，而不会将睡觉或午休时间误认为专注。

#### 验收标准

1. 当用户首次设置时，系统应当提供默认的睡眠时间设置（晚上11点到早上7点）
2. 当用户修改睡眠时间时，系统应当保存设置并在专注计算中应用新的时间范围
3. 当用户启用午休排除功能时，系统应当允许设置午休时间段（默认中午12点到下午2点）
4. 当检测到在休息时间段内的手机未使用时，系统应当不将其计算为专注时间
5. 当用户查看专注统计时，系统应当显示已排除的休息时间段信息
6. 如果用户在设定的休息时间内频繁使用手机，系统应当提醒用户调整休息时间设置
7. 当用户跨时区旅行时，系统应当提供临时调整时间设置的选项

### 需求 9

**用户故事：** 作为用户，我想要为我的时间使用添加场景标签分类，这样我就能更清楚地了解自己在不同场景下的时间分配情况。

#### 验收标准

1. 当用户首次使用应用时，系统应当提供预设的场景标签（工作、学习、娱乐、社交、健康、购物、出行等）
2. 当用户查看应用使用记录时，系统应当根据应用类型智能推荐合适的场景标签
3. 当用户创建自定义标签时，系统应当保存标签并在后续使用中提供选择
4. 当用户手动修改时间记录的标签时，系统应当保存修改并更新相关统计
5. 当用户查看时间分析时，系统应当按场景标签分组显示时间分布
6. 当AI分析用户行为时，系统应当基于场景标签提供更精准的时间管理建议
7. 当用户设置目标时，系统应当支持为不同场景设置独立的时间目标
8. 当生成报告时，系统应当显示各场景的时间占比和变化趋势

### 需求 10

**用户故事：** 作为用户，我想要应用能够在后台持续监测我的专注状态，这样即使我没有主动打开应用，它也能准确记录我的专注时间。

#### 验收标准

1. 当应用获得后台应用刷新权限时，系统应当能够在后台继续监测用户行为
2. 当应用进入后台时，系统应当启动后台任务以维持监测功能
3. 当后台任务运行时，系统应当监听应用状态变化以检测专注时段
4. 当后台任务即将到期时，系统应当调度BGProcessingTask以继续后台处理
5. 当用户长时间未使用设备时，后台任务应当能够检测到这种专注状态
6. 当应用重新进入前台时，系统应当处理后台期间检测到的专注数据
7. 当检测到重复的专注会话时，系统应当防止重复保存相同的数据
8. 如果用户禁用后台应用刷新，系统应当在应用内提示用户启用此功能以获得最佳体验